// a little command to spec/unspec any player on server
// supports forceing too (force = player can't rejoin game even in open/veto mastermode) 
// Author: /BudSpencer ( 2016 )
// you'll need admin privileges to execute #lists command, for #spec master is enough :)


reason = "None"
ip_lock_list = []
cn_lock_list = []
name_lock_list = []

cmd_spectator = [
	ip = ( getip $arg3 )
	cn = ( getcn $arg3 )
	name_ = ( getname $arg3 )
	player1 = ( concatword ( getname $arg1 ) "(" $arg1 ")^f7." )
	player2 = ( concatword ( getname $arg3 ) "(" $arg3 ")" )
	if ( || ( <= 128 $arg3 ) ( || ( =s $arg3 "-1" ) ( =s $arg3 "-2" ) ) ) [
		pm $arg1 ( concat "You can't" ( ? $arg2 "^f4spectate" "^f4unspectate" ) "^f7a ^f4bot^f7." )
	] [
	if ( = 2 $arg1 ) [
		pm $arg1 ( concat "You can't" ( ? $arg2 "^f3spectate" "^f3unspectate" ) "^f7yourself. Ask another ^f4master/admin ^f7for" ( ? $arg2 "^f4speccing" "^f4unspeccing" ) "^f7you." )
	] [
	if ( = $arg2 1 ) [ spectator 1 $arg3 ] [ spectator 0 $arg3 ]
	if ( !=s $arg5 "" ) [ reason = $arg5 ] [ reason = "None" ]
	reason_ = ( concatword $reason "^f7." )
		if ( = $arg4 1 ) [
				if ( = $arg2 1 ) [
					ip_lock_list = ( listadd $ip_lock_list $ip )
					cn_lock_list = ( listadd $cn_lock_list $cn )
					name_lock_list = ( listadd $name_lock_list $name_ )
				] [
				if ( = $arg2 0 ) [
					ip_lock_list = ( listdel $ip_lock_list $ip )
					cn_lock_list = ( listdel $cn_lock_list $cn )
					name_lock_list = ( listdel $name_lock_list $name_ )
				]
			]
			say ( concat "Player^f3"$player2 "^f7has been" ( ? $arg2 "forced to spectator" "unspectated" ) "by^f4" $player1 "Reason:^f4" $reason_ )
		] [
		if ( = $arg4 0 ) [
			say ( concat "Player^f3"$player2 "^f7has been" ( ? $arg2 "spectated" "unspectated" ) "by^f4" $player1 "Reason:^f4" $reason_ )
				] [ pm $arg1 ( format "You need to ^f3type ^f7a valid ^f4boolean(1 or 0)^f7." ) ]
			]
		]
	]
]

spec_force = [
	if ( = ( isspectator $arg1 ) 0 ) [
		if ( || ( && ( > ( indexof $ip_lock_list ( getip $arg1 ) ) -1 ) ( > ( indexof $cn_lock_list ( getcn $arg1 ) ) -1 ) ) ( > ( indexof $name_lock_list ( getname $arg1 ) ) -1 ) ) [ // if player is on all lists
			spectator 1 $arg1
			pm $arg1 ( format "You're forced to ^f3spectator ^f7and not able to ^f4rejoin ^f7game yet^f7." )
		]
	]
]

reconnect_player = [
	if ( && ( > ( indexof $name_lock_list ( getname $arg1 ) ) -1 ) ( > ( indexof $ip_lock_list ( getip $arg1 ) ) -1 ) ) [
		spectator 1 $arg1
		pm $arg1 ( format "You're forced to ^f3spectator ^f7and not able to ^f4rejoin ^f7game yet^f7." )
	]
]

cmd_lists = [
	msg = "Element ^f3'%1' ^f7has been successfully deleted from list ^f4'%2'^f7."
	err = "Element ^f3'%1' ^f7doesn't exist at list ^f4'%2'^f7."
	cle = "All Elements from list ^f3'%1' ^f7have been ^f4removed^f7."
	a = "Names"
	b = "IP's"
	c = "CN's"
	
	if ( && ( =s $arg2 "CLEAR" ) ( =s $arg3 "ALL" ) ) [
		name_lock_list = []
		ip_lock_list = []
		cn_lock_list = []
		pm $arg1 ( format "All ^f3lists ^f7have been ^f4cleared ^f7successfully^f7." )
		] [
	if ( && ( =s $arg2 "" ) ( =s $arg3 "" ) ) [
		list1 = $name_lock_list 
		list2 = $cn_lock_list
		list3 = $ip_lock_list
			pm $arg1 ( format "Do ^f3#lists <NAMES|IPS|CNS> <element-to-delete> ^f7to delete a specified element from a specified list^f7." )
			pm $arg1 ( format "Spectated ^f3Names^f7: ^f4%1^n^f7Spectated ^f3cn's^f7: ^f4%2^n^f7Spectated ^f3IP's^f7: ^f4%3" $list1 $list2 $list3 )
	] [
	cases $arg2 "NAMES" [
		if ( && ( = ( indexof $name_lock_list $arg3 ) -1 ) ( !=s $arg3 "CLEAR" ) ) [ pm $arg1 ( format $err $arg3 $a ) ] [
			if ( =s $arg3 "CLEAR" ) [ name_lock_list = [] ; pm $arg1 ( format $cle $a ) ] [
				name_lock_list = ( listdel $name_lock_list $arg3 )
				pm $arg1 ( format $msg $arg3 $a )
			]
		]
	] "CNS" [
		if ( && ( = ( indexof $cn_lock_list $arg3 ) -1 ) ( !=s $arg3 "CLEAR" ) ) [ pm $arg1 ( format $err $arg3 $c ) ] [
			if ( =s $arg3 "CLEAR" ) [ cn_lock_list = [] ; pm $arg1 ( format $cle $c ) ] [
				cn_lock_list = ( listdel $cn_lock_list $arg3 )
				pm $arg1 ( format $msg $arg3 $c )
			]
		]
	] "IPS" [
		if ( && ( = ( indexof $ip_lock_list $arg3 ) -1 ) ( !=s $arg3 "CLEAR" ) ) [ pm $arg1 ( format $err $arg3 $b ) ] [
			if ( =s $arg3 "CLEAR" ) [ ip_lock_list = [] ; pm $arg1 ( format $cle $b ) ] [
				ip_lock_list = ( listdel $ip_lock_list $arg3 )
				pm $arg1 ( format $msg $arg3 $b )
					]
				]
			]
		]
	]	
]



addhandler "onspectator" spec_force
addhandler "onconnect" reconnect_player
registercommand "lists" cmd_lists 3 "|ww" "lists (<NAMES|IPS|CNS|CLEAR>) (<element-to-delete|CLEAR|ALL>) ^f3That command allows you to delete a specified element from a specified list. That's useful when you have much trash in your list. (e.g. #lists NAMES /BudSpencer ----> that'd delete (if it exists) element '/BudSpencer' from list 'NAMES'.)"   
registercommand "spec" cmd_spectator 2 "ici|s" "spec <1|0> <cn> <1|0> (<reason>) ^f3This command allows you to spectate or unspectate any player on server. You can force a player to spectator (e.g. #spec 1 0 1 teamkiller ---> with the last 1 you call the spec force), if gamemode is not locked/private. He can't join game then. You can also add an additional reason for other privileged players why player is spectated." 
